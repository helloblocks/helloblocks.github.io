{"version":3,"sources":["webpack:///./node_modules/@babel/runtime/helpers/esm/typeof.js","webpack:///./src/plugins/serial/base-serial.js","webpack:///./src/plugins/serial/navserial.js"],"names":["_typeof","obj","Symbol","iterator","constructor","prototype","signalMap","dtr","rts","brk","cts","dsr","dcd","BaseSerial","requestRequired","mute","baud","Number","sessionStorage","currentBaudRate","lastBaud","devices","currentDevice","connected","implementation","serial","DEBUG","process","VUE_APP_DEBUG","store","getters","query","key","data","settings","value","encoding","Vue","$serial","this","Promise","all","map","device","isDevice","isDevices","filter","i","console","log","update","baudRate","setBaud","val","sig","trans","Object","keys","forEach","signals","isOpen","Error","sigs","_transSignal","set","get","resolve","reject","read","buff","err","toString","write","_currentDevice","open","emit","pause","close","resume","name","push","find","d","cb","connect","opts","disconnect","setSignals","getSignals","size","readBuff","slice","Math","min","length","Infinity","paused","message","writeBuff","Buffer","from","EventEmitter","navigator","NavSerial","JSON","parse","localStorage","portNames","handlesSelect","_dataHandler","_lastRead","_openHandler","args","_closeHandler","_errorHandler","_unregisterSerial","_initSerial","filters","usbVendorId","usbProductId","requestPort","classCode","setCurrentDevice","_getDevice","port","BrowserSerialPort","autoOpen","on","off","_registerSerial","window","lastNavSerialPort","stringify","getInfo","error","getPorts","info"],"mappings":"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","file":"js/serial-nav-app.4ac857b9.js","sourcesContent":["export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","/* eslint-disable no-unused-vars */\n/* eslint-disable class-methods-use-this */\nimport EventEmitter from 'events';\nimport store from '@/store';\n\n/*\nInterface should emit the following:\nthis.emit('data', buffer)\nthis.emit('message', string) // should be a string version of buffer\n// message should not be emitted whilst this.mute === true\nthis.emit('connected', value)\nthis.emit('disconnected', value)\nthis.emit('deviceNamePrompt', value) // prompts the user to input a readable device name\n*/\n\nconst signalMap = {\n  dtr: 'dataTerminalReady',\n  rts: 'requestToSend',\n  brk: 'break',\n  cts: 'clearToSend',\n  dsr: 'dataSetReady',\n  dcd: 'dataCarrierDetect',\n};\n\nclass BaseSerial extends EventEmitter {\n  constructor() {\n    super();\n    this.requestRequired = false;\n    this.mute = false;\n    this.baud = Number(sessionStorage.currentBaudRate) || 9600;\n    this.lastBaud = 9600;\n    this.devices = [];\n    this.currentDevice = null;\n    this.connected = false;\n    this.implementation = 'basic';\n    this.serial = null;\n    this.DEBUG = !!process.env.VUE_APP_DEBUG;\n    // eslint-disable-next-line no-console\n    // console.log('debug', this.DEBUG);\n  }\n\n  get encoding() {\n    const [settings] = store.getters['settings/find']({ query: { key: 'monitor' } }).data;\n    return settings?.value?.encoding || 'ascii';\n  }\n\n  install(Vue) {\n    // eslint-disable-next-line no-param-reassign\n    Vue.$serial = this;\n    // eslint-disable-next-line no-param-reassign\n    Vue.prototype.$serial = this;\n  }\n\n  async requestDevice() { return {}; }\n\n  async listDevices() {\n    const isDevices = await Promise.all(this.devices.map((device) => this.isDevice(device.value)));\n    return this.devices.filter((device, i) => isDevices[i]);\n  }\n\n  async isDevice(value) { return true; }\n\n  async setCurrentDevice(value) { this.currentDevice = value; }\n\n  async setBaud(baud) {\n    // eslint-disable-next-line no-console\n    if (this.DEBUG) console.log('setting speed', baud);\n    if (this.serial) await this.serial.update({ baudRate: baud });\n    this.baud = baud;\n    sessionStorage.currentBaudRate = baud;\n    return baud;\n  }\n\n  async resetBaud() {\n    this.setBaud(this.lastBaud);\n  }\n\n  async setMute(val) { this.mute = val; }\n\n  _transSignal(sig) {\n    let trans = {};\n    if (typeof sig === 'object') {\n      trans = { ...sig };\n    }\n    if (sig === 'on' || sig === true) {\n      trans = {\n        dtr: true,\n        rts: true,\n      };\n    }\n    if (sig === 'off' || sig === false) {\n      trans = {\n        dtr: false,\n        rts: false,\n      };\n    }\n    Object.keys(signalMap).forEach((i) => {\n      if (typeof trans[i] === 'boolean') trans[signalMap[i]] = trans[i];\n      if (typeof trans[signalMap[i]] === 'boolean') trans[i] = trans[signalMap[i]];\n    });\n    return trans;\n  }\n\n  async setSignals(signals) {\n    if (!this.serial?.isOpen) throw new Error('Cannot write to closed port.');\n    // eslint-disable-next-line no-console\n    if (this.DEBUG) console.log('signaling', signals);\n    const sigs = this._transSignal(signals);\n    return this.serial.set(sigs);\n  }\n\n  async getSignals() {\n    if (!this.serial?.isOpen) throw new Error('Cannot read closed port.');\n    const signals = await this.serial.get();\n    return this._transSignal(signals);\n  }\n\n  readBuff() {\n    return new Promise((resolve, reject) => this.serial?.read((buff, err) => {\n      if (err) reject(err);\n      else resolve();\n    }));\n  }\n\n  writeBuff(buff) {\n    // eslint-disable-next-line no-console\n    if (this.DEBUG) console.log('write', buff.toString('hex'));\n    return new Promise((resolve, reject) => this.serial.write(buff, (err) => {\n      if (err) reject(err);\n      else resolve();\n    }));\n  }\n\n  connect() {\n    if (!this.serial) throw new Error('Cannot connect to un-initiated device.');\n    if (!this._currentDevice || this.serial.isOpen) {\n      // eslint-disable-next-line no-console\n      if (this.DEBUG) console.log('skipping connect');\n      return Promise.resolve();\n    }\n    return new Promise((resolve, reject) => this.serial.open((err) => {\n      if (err) return reject(err);\n      this.connected = true;\n      this.emit('connected', this.currentDevice);\n      return resolve();\n    }));\n  }\n\n  async disconnect() {\n    if (!this._currentDevice || !this.serial?.isOpen) return;\n    this.serial.pause();\n    await this.serial.close();\n    this.serial.resume();\n    this.connected = false;\n    this.emit('disconnect', this.currentDevice);\n    this.emit('close');\n    // eslint-disable-next-line no-console\n    if (this.DEBUG) console.log('disconnected');\n  }\n\n  async setDeviceName(value, name) {\n    if (await this.isDevice(value)) this.devices.push({ value, name });\n  }\n\n  async getDeviceName(value) {\n    return (this.devices.find((d) => d.value === value) || { name: '' }).name;\n  }\n\n  // node-serialport properties\n  get isOpen() { return this.connected; }\n\n  get path() { return this.implementation; }\n\n  get baudRate() { return this.baud; }\n\n  async open(cb = () => {}) {\n    try {\n      await this.connect();\n    } catch (err) {\n      cb?.(err);\n      return;\n    }\n    cb?.();\n  }\n\n  async update(opts = {}, cb = () => {}) {\n    try {\n      if (opts.baudRate) {\n        await this.setBaud(opts.baudRate);\n      }\n    } catch (err) {\n      cb?.(err);\n      return;\n    }\n    cb?.();\n  }\n\n  async close(cb = () => {}) {\n    try {\n      await this.disconnect();\n    } catch (err) {\n      cb?.(err);\n      return;\n    }\n    cb?.();\n  }\n\n  async set(opts = {}, cb = () => {}) {\n    try {\n      await this.setSignals(opts);\n    } catch (err) {\n      cb?.(err);\n      return;\n    }\n    cb?.();\n  }\n\n  async get(cb = () => {}) {\n    let sigs = {};\n    try {\n      sigs = await this.getSignals();\n    } catch (err) {\n      cb?.(err, null);\n      return;\n    }\n    cb?.(null, sigs);\n  }\n\n  async read(size) {\n    const buff = await this.readBuff();\n    return buff && buff.slice(0, Math.min(buff.length, size || Infinity));\n  }\n\n  drain(cb = () => {}) { cb?.(); }\n\n  flush(cb = () => {}) { cb?.(); }\n\n  pause() {\n    this.serial?.paused?.();\n  }\n\n  resume() {\n    this.serial?.resume?.();\n  }\n\n  async write(message, encoding = null, cb = () => {}) {\n    if (typeof encoding === 'function') {\n      // eslint-disable-next-line no-param-reassign\n      cb = encoding;\n      // eslint-disable-next-line no-param-reassign\n      encoding = null;\n    }\n    if (this.mute && typeof message === 'string') return;\n    try {\n      await this.writeBuff(typeof message === 'string' ? Buffer.from(message, encoding || this.encoding) : message);\n    } catch (err) {\n      cb?.(err);\n      return;\n    }\n    cb?.();\n  }\n}\n\nexport default BaseSerial;\n","import Vue from 'vue';\n// import { v4 as uuid4 } from 'uuid';\nimport BrowserSerialPort from 'avrgirl-arduino/lib/browser-serialport';\nimport BaseSerial from './base-serial';\n\nconst { serial } = navigator;\n\n// eslint-disable-next-line no-console\nconsole.log('using navserial');\nclass NavSerial extends BaseSerial {\n  constructor() {\n    super();\n    this.requestRequired = true;\n    this.devices = JSON.parse(localStorage.portNames || '[]');\n    this._currentDevice = null;\n    this.implementation = 'navserial';\n    this.handlesSelect = true;\n\n    this._dataHandler = (buff) => {\n      this._lastRead = buff;\n      // eslint-disable-next-line no-console\n      if (this.DEBUG) console.log('read', Buffer.from(buff).toString('hex'));\n      if (!this.mute) this.emit('message', buff.toString(this.encoding));\n      this.emit('data', buff);\n    };\n    this._openHandler = (...args) => {\n      this.emit('open', ...args);\n    };\n    this._closeHandler = (...args) => {\n      this.emit('close', ...args);\n    };\n    this._errorHandler = (...args) => {\n      this.emit('close', ...args);\n      this._currentDevice = null;\n      Vue.set(this, 'currentDevice', null);\n\n      if (this.serial) this._unregisterSerial();\n\n      this.emit('currentDevice', null);\n    };\n    this._initSerial();\n  }\n\n  // eslint-disable-next-line class-methods-use-this\n  async _getDevice(value) {\n    // const devices = await serial.getPorts();\n    // console.log(devices);\n    // return devices.find((d) => d.id === value) || null;\n    return value;\n  }\n\n  async requestDevice() {\n    // Filter on devices.\n    const filters = [\n      // Arduino\n      { usbVendorId: 0x2341, usbProductId: 0x0043 }, // UNO\n      { usbVendorId: 0x2341, usbProductId: 0x0001 },\n      { usbVendorId: 0x2341, usbProductId: 0x0243 },\n      { usbVendorId: 0x2A03, usbProductId: 0x0043 },\n      // WCH\n      { usbVendorId: 0x1A86, usbProductId: 0x7523 }, // CH340\n      { usbVendorId: 0x1A86, usbProductId: 0x5523 }, // CH341\n      { usbVendorId: 0x4348, usbProductId: 0x5523 },\n      // FTDI\n      { usbVendorId: 0x0403, usbProductId: 0x6001 }, // FT232x & FT245x\n      { usbVendorId: 0x0403, usbProductId: 0x6010 }, // FT2232\n      { usbVendorId: 0x0403, usbProductId: 0x6011 }, // FT4232\n      { usbVendorId: 0x0403, usbProductId: 0x6014 }, // FT232x\n      { usbVendorId: 0x0403, usbProductId: 0x6015 }, // FTDI Bridge(I2C/SPI/UART/FIFO)\n      { usbVendorId: 0x0403, usbProductId: 0x6031 }, // FTDI MISC\n      // Bricked Counterfeit\n      { usbVendorId: 0x0403, usbProductId: 0x0000 }, // FTDI FT232\n      // Silicon Labs\n      { usbVendorId: 0x10C4, usbProductId: 0x80A9 }, // CP210x\n      { usbVendorId: 0x10C4, usbProductId: 0xEA60 },\n      { usbVendorId: 0x10C4, usbProductId: 0xEA61 },\n      { usbVendorId: 0x10C4, usbProductId: 0xEA70 },\n      { usbVendorId: 0x10C4, usbProductId: 0xEA71 },\n      { usbVendorId: 0x10C4, usbProductId: 0xEA80 },\n      { usbVendorId: 0x10C4, usbProductId: 0xEAD0 },\n      // Prolific\n      { usbVendorId: 0x067B, usbProductId: 0x2303 }, // PL2303\n      { usbVendorId: 0x067B, usbProductId: 0x2304 },\n      { usbVendorId: 0x067B, usbProductId: 0x04BB },\n      { usbVendorId: 0x067B, usbProductId: 0xAAA2 },\n      { usbVendorId: 0x067B, usbProductId: 0xAAA3 },\n      // Microchip\n      { usbVendorId: 0x04D8, usbProductId: 0x000A }, // MCP2221\n      { usbVendorId: 0x04D8, usbProductId: 0x0205 },\n      { usbVendorId: 0x04D8, usbProductId: 0x0206 },\n      { usbVendorId: 0x04D8, usbProductId: 0x00DF },\n      { usbVendorId: 0x04D8, usbProductId: 0x0057 },\n      { usbVendorId: 0x04D8, usbProductId: 0x006E },\n      { usbVendorId: 0x04D8, usbProductId: 0x0208 },\n      { usbVendorId: 0x04D8, usbProductId: 0x00DD },\n      { usbVendorId: 0x04D8, usbProductId: 0x0207 },\n      // Cypress\n      { usbVendorId: 0x04B4, usbProductId: 0x0003 }, // CY7C65213\n      // Holtek\n      { usbVendorId: 0x04D9, usbProductId: 0xB534 }, // HT42B534\n    ];\n    try {\n      const device = await serial.requestPort({ classCode: 2, filters });\n      this.setCurrentDevice(device);\n    } catch (e) {\n      this.emit('serialPortCancel', e);\n    }\n    // if (!device.id) device.id = uuid4();\n    // if (await this.getDeviceName(device.id)) {\n    //   console.log(this.getDeviceName(device.id));\n    //   this.setCurrentDevice(device.id);\n    // } else {\n    //   this.emit('deviceNamePrompt', device.id);\n    // }\n  }\n\n  async isDevice(value) {\n    return !!(await this._getDevice(value));\n  }\n\n  _registerSerial(port) {\n    this.serial = new BrowserSerialPort(port, {\n      baudRate: this.baud,\n      autoOpen: false,\n    });\n    this.serial.on('data', this._dataHandler);\n    this.serial.on('open', this._openHandler);\n    this.serial.on('close', this._closeHandler);\n    this.serial.on('error', this._errorHandler);\n  }\n\n  _unregisterSerial() {\n    this.serial.off('data', this._dataHandler);\n    this.serial.off('open', this._openHandler);\n    this.serial.off('close', this._closeHandler);\n  }\n\n  async setCurrentDevice(value) {\n    if (!(await this.isDevice(value))) return;\n    if (this.connected) await this.disconnect();\n    this._currentDevice = await this._getDevice(value);\n    Vue.set(this, 'currentDevice', value);\n\n    if (this.serial) this._unregisterSerial();\n    this._registerSerial(value);\n\n    this.emit('currentDevice', value);\n    try {\n      await this.connect();\n      window.localStorage.lastNavSerialPort = JSON.stringify(value.getInfo());\n    } catch (err) {\n      if (err.message === 'Access denied.') {\n        this.emit('errorPrompt', 'access_denied');\n      }\n      // eslint-disable-next-line no-console\n      console.error(err);\n    }\n    // eslint-disable-next-line no-console\n    if (this.DEBUG) console.log(value, value.getInfo());\n  }\n\n  async disconnectDevice() {\n    if (this.connected) await this.disconnect();\n    this._currentDevice = null;\n    Vue.set(this, 'currentDevice', null);\n\n    if (this.serial) this._unregisterSerial();\n\n    this.emit('currentDevice', null);\n  }\n\n  async _initSerial() {\n    const { usbProductId, usbVendorId } = JSON.parse(window.localStorage.lastNavSerialPort || '{}');\n    if (!usbVendorId || !usbProductId) return;\n    const devices = await serial.getPorts();\n    const device = devices.find((d) => {\n      const info = d.getInfo();\n      return usbProductId === info.usbProductId && usbVendorId === info.usbVendorId;\n    });\n    if (device) this.setCurrentDevice(device);\n  }\n\n  async setDeviceName(value, name) {\n    if (!(await this.isDevice(value))) return;\n    this.devices.push({ value, name });\n    localStorage.portNames = JSON.stringify(this.devices);\n    this.setCurrentDevice(value);\n  }\n}\n\nexport default NavSerial;\n"],"sourceRoot":""}